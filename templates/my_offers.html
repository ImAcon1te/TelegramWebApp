{% extends 'base.html' %}
{% block title %}Мої пропозиції{% endblock %}
{% block content %}
<h1>Мої пропозиції</h1>
   {% if user.is_sale %}
        <div style="margin-bottom: 20px;">
          <a href="{{ url_for('sale_offers') }}">Заявки на продажу</a>
        </div>
    {% endif %}
    {% if user.is_rental %}
        <div style="margin-bottom: 20px;">
          <a href="{{ url_for('rental_offers') }}">Заявки аренду</a>
        </div>
    {% endif %}
    {% if user.is_purchase %}
        <div style="margin-bottom: 20px;">
          <a href="{{ url_for('purchase_offers') }}">Заявки на покупку</a>
        </div>
    {% endif %}
<!-- Раздел для заявок на продаж -->
<h2>Заявки на продаж</h2>
{% if sale_offers %}
  {% for offer in sale_offers %}
    <div class="offer-block" style="border: 1px solid #ccc; padding: 15px; margin-bottom: 15px;">
      <p><strong>ID:</strong> {{ offer.id }}</p>
      <p><strong>Тип культури/товару:</strong> {{ offer.commodity_type }}</p>
      <p><strong>Тонаж:</strong> {{ offer.tonnage }}</p>
      <p><strong>Цена за тонну:</strong> {{ offer.price_per_ton }}</p>
      <p><strong>Регион:</strong> {{ offer.region.oblast }}</p>
      <p><strong>Дополнительно:</strong> {{ offer.additional_info or '—' }}</p>
      <button class="delete-offer-btn" data-offer-id="{{ offer.id }}" data-offer-type="sale">відкликати заявку</button>
      <button class="edit-offer-btn" data-offer-id="{{ offer.id }}" data-offer-type="sale">відредагувати</button>
    </div>
  {% endfor %}
{% else %}
  <p>Немає заявок на продаж</p>
{% endif %}

<!-- Раздел для заявок на закупку -->
<h2>Заявки на закупку</h2>
{% if purchase_offers %}
  {% for offer in purchase_offers %}
    <div class="offer-block" style="border: 1px solid #ccc; padding: 15px; margin-bottom: 15px;">
      <p><strong>ID:</strong> {{ offer.id }}</p>
      <p><strong>Тип культури/товару:</strong> {{ offer.commodity_type }}</p>
      <p><strong>Тонаж:</strong> {{ offer.tonnage }}</p>
      <p><strong>Цена за тонну:</strong> {{ offer.price_per_ton }}</p>
      <p><strong>Регион:</strong> {{ offer.region.oblast }}</p>
      <p><strong>Дополнительно:</strong> {{ offer.additional_info or '—' }}</p>
      <button class="delete-offer-btn" data-offer-id="{{ offer.id }}" data-offer-type="purchase">відкликати заявку</button>
      <button class="edit-offer-btn" data-offer-id="{{ offer.id }}" data-offer-type="purchase">відредагувати</button>
    </div>
  {% endfor %}
{% else %}
  <p>Немає заявок на закупку</p>
{% endif %}

<!-- Раздел для заявок на аренду -->
<h2>Заявки на аренду</h2>
{% if rental_offers %}
  {% for offer in rental_offers %}
    <div class="offer-block" style="border: 1px solid #ccc; padding: 15px; margin-bottom: 15px;">
      <p><strong>ID:</strong> {{ offer.id }}</p>
      <p><strong>Тип техники:</strong> {{ offer.equipment_type }}</p>
      <p><strong>Стоимость аренды:</strong> {{ offer.rental_price }}</p>
      <p><strong>Единица времени:</strong> {{ offer.time_unit.value }}</p>
      <p><strong>Дополнительно:</strong> {{ offer.additional_info or '—' }}</p>
      <button class="delete-offer-btn" data-offer-id="{{ offer.id }}" data-offer-type="rental">відкликати заявку</button>
      <button class="edit-offer-btn" data-offer-id="{{ offer.id }}" data-offer-type="rental">відредагувати</button>
    </div>
  {% endfor %}
{% else %}
  <p>Немає заявок на аренду</p>
{% endif %}

<!-- Модальное окно для подтверждения удаления -->
<div id="deleteModal" class="modal-overlay">
  <div class="modal-content">
    <p>Ви впевнені, що хочете відкликати заявку? Ця дія видалить заявку та всі пов’язані пропозиції.</p>
    <div class="modal-buttons">
      <button id="confirmDelete">Так</button>
      <button id="cancelDelete">Ні</button>
    </div>
  </div>
</div>

<!-- Модальное окно для редактирования заявки -->
<div id="editModal" class="modal-overlay">
  <div class="modal-content">
    <span id="closeEditModal" class="modal-close">&times;</span>
    <h2>Редагувати заявку</h2>
    <form id="editOfferForm">
      <!-- Поля формы заполняются динамически в зависимости от типа заявки -->
      <div id="editFields"></div>
      <div class="modal-buttons">
        <button type="button" id="cancelEdit">Відмінити</button>
        <button type="button" id="saveEdit">Зберегти</button>
      </div>
    </form>
  </div>
</div>

<style>
/* Стили для модальных окон */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
}
.modal-content {
  position: relative;
  width: 400px;
  margin: 100px auto;
  background: #fff;
  padding: 20px;
  border-radius: 4px;
}
.modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 20px;
  cursor: pointer;
}
.modal-buttons {
  text-align: right;
  margin-top: 15px;
}
.modal-buttons button {
  margin-left: 10px;
}
</style>

<script src="{{ url_for('static', filename='my_offers.js') }}"></script>

{% endblock %}
